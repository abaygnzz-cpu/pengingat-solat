<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Penghitung Kalori Harian</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background: #f3f4f6;
    color: #222;
    margin: 0;
    padding: 0;
  }
  header {
    background: #2563eb;
    color: #fff;
    padding: 1rem;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
  }
  .container {
    max-width: 800px;
    margin: 2rem auto;
    background: #fff;
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  input, select, button {
    padding: 0.6rem;
    border-radius: 0.5rem;
    border: 1px solid #ccc;
    font-size: 1rem;
    width: 100%;
    margin: 0.3rem 0;
  }
  button {
    background: #2563eb;
    color: #fff;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #1e40af;
  }
  #chart {
    margin-top: 1.5rem;
  }
  .row {
    display: flex;
    gap: 0.5rem;
  }
  .row > * {
    flex: 1;
  }
  .summary {
    margin-top: 1rem;
    background: #f9fafb;
    border-radius: 0.5rem;
    padding: 1rem;
  }
  .food-list {
    margin-top: 1rem;
    max-height: 200px;
    overflow-y: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    text-align: left;
    padding: 0.5rem;
    border-bottom: 1px solid #ddd;
  }
  .delete {
    color: #ef4444;
    cursor: pointer;
  }
</style>
</head>
<body>
<header>üçΩÔ∏è Penghitung Kalori Harian</header>
<div class="container">
  <div class="row">
    <input type="text" id="searchFood" placeholder="Cari makanan (misal: nasi goreng)">
    <datalist id="foodList"></datalist>
  </div>
  <div class="row">
    <input type="number" id="foodWeight" placeholder="Berat (gram)">
    <button id="addFood">Tambah</button>
  </div>

  <div class="row">
    <input type="number" id="calNeed" placeholder="Kebutuhan kalori harian (kcal)">
    <select id="goal">
      <option value="maintain">Pertahankan berat</option>
      <option value="deficit">Defisit kalori (turun berat)</option>
      <option value="surplus">Surplus kalori (naik berat)</option>
    </select>
  </div>

  <div class="summary">
    <p><strong>Total Kalori:</strong> <span id="totalCal">0</span> kcal</p>
    <p><strong>Total Protein:</strong> <span id="totalProtein">0</span> g</p>
    <p><strong>Sisa Kalori:</strong> <span id="remainingCal">0</span> kcal</p>
  </div>

  <div class="food-list">
    <table>
      <thead><tr><th>Makanan</th><th>Kalori</th><th>Protein</th><th>Aksi</th></tr></thead>
      <tbody id="foodTable"></tbody>
    </table>
  </div>

  <canvas id="chart" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const foodData = {
  "nasi putih": { cal: 130, protein: 2.5 },
  "nasi goreng": { cal: 250, protein: 6 },
  "ayam goreng": { cal: 260, protein: 25 },
  "ayam bakar": { cal: 200, protein: 27 },
  "ikan goreng": { cal: 220, protein: 23 },
  "ikan bakar": { cal: 180, protein: 22 },
  "tempe goreng": { cal: 190, protein: 10 },
  "tahu goreng": { cal: 150, protein: 8 },
  "mie goreng": { cal: 300, protein: 8 },
  "bakso": { cal: 150, protein: 10 },
  "soto ayam": { cal: 120, protein: 12 },
  "rendang": { cal: 250, protein: 21 },
  "telur rebus": { cal: 70, protein: 6 },
  "telur dadar": { cal: 95, protein: 7 },
  "roti tawar": { cal: 90, protein: 3 },
  "sate ayam": { cal: 270, protein: 25 },
  "jus alpukat": { cal: 160, protein: 2 },
  "es teh manis": { cal: 90, protein: 0 },
  "soto betawi": { cal: 200, protein: 15 },
  "gado-gado": { cal: 220, protein: 9 },
  "pecel": { cal: 180, protein: 7 },
  "sayur asem": { cal: 70, protein: 3 },
  "bakso urat": { cal: 180, protein: 12 },
  "mie ayam": { cal: 400, protein: 15 },
  "nasi padang": { cal: 600, protein: 25 },
  "nasi uduk": { cal: 450, protein: 10 },
  "sate kambing": { cal: 300, protein: 22 },
  "sambal": { cal: 40, protein: 1 },
  "kerupuk": { cal: 100, protein: 1 },
  "jus jeruk": { cal: 85, protein: 1 },
  "kopi susu": { cal: 110, protein: 3 }
};

let foods = JSON.parse(localStorage.getItem("foods") || "[]");
let calNeed = localStorage.getItem("calNeed") || 2000;
let goal = localStorage.getItem("goal") || "maintain";
let chart;

function updateList() {
  const tbody = document.getElementById("foodTable");
  tbody.innerHTML = "";
  let totalCal = 0, totalProtein = 0;

  foods.forEach((f, i) => {
    totalCal += f.cal;
    totalProtein += f.protein;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${f.name}</td>
      <td>${f.cal.toFixed(1)}</td>
      <td>${f.protein.toFixed(1)}</td>
      <td><span class="delete" onclick="deleteFood(${i})">üóëÔ∏è</span></td>`;
    tbody.appendChild(tr);
  });

  const adjust = goal === "deficit" ? -300 : goal === "surplus" ? 300 : 0;
  const remaining = (parseFloat(calNeed) + adjust) - totalCal;

  document.getElementById("totalCal").textContent = totalCal.toFixed(1);
  document.getElementById("totalProtein").textContent = totalProtein.toFixed(1);
  document.getElementById("remainingCal").textContent = remaining.toFixed(1);

  localStorage.setItem("foods", JSON.stringify(foods));
  localStorage.setItem("calNeed", calNeed);
  localStorage.setItem("goal", goal);
  updateChart(totalCal, remaining);
}

function updateChart(totalCal, remaining) {
  const ctx = document.getElementById("chart").getContext("2d");
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Terkonsumsi", "Sisa"],
      datasets: [{
        data: [totalCal, Math.max(remaining, 0)],
        backgroundColor: ["#2563eb", "#e5e7eb"],
        borderWidth: 0
      }]
    },
    options: {
      plugins: { legend: { display: true } },
      animation: { duration: 300 }
    }
  });
}

function deleteFood(i) {
  foods.splice(i, 1);
  updateList();
}

document.getElementById("addFood").addEventListener("click", () => {
  const name = document.getElementById("searchFood").value.toLowerCase();
  const weight = parseFloat(document.getElementById("foodWeight").value);
  if (!foodData[name] || isNaN(weight) || weight <= 0) return alert("Masukkan data valid!");

  const cal = foodData[name].cal * weight / 100;
  const protein = foodData[name].protein * weight / 100;
  foods.push({ name, cal, protein });
  document.getElementById("foodWeight").value = "";
  updateList();
});

document.getElementById("searchFood").addEventListener("input", e => {
  const val = e.target.value.toLowerCase();
  const list = Object.keys(foodData).filter(f => f.includes(val)).slice(0, 10);
  const datalist = document.getElementById("foodList");
  datalist.innerHTML = list.map(f => `<option value="${f}">`).join("");
});

document.getElementById("calNeed").addEventListener("input", e => calNeed = e.target.value);
document.getElementById("goal").addEventListener("change", e => goal = e.target.value);

updateList();
</script>
</body>
</html>
