<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Penghitung Kalori Harian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .card { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .fade-in { animation: fadeIn .5s ease-in; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-100 to-gray-200 text-gray-900 min-h-screen">

  <div class="max-w-3xl mx-auto mt-8 bg-white p-6 rounded-2xl card fade-in">
    <h1 class="text-2xl font-bold text-center mb-6 text-blue-700">üçé Penghitung Kalori Harian</h1>

    <!-- Bagian Data Pengguna -->
    <section class="border-b pb-4 mb-5">
      <h2 class="text-lg font-semibold mb-3">üìã Data Pengguna</h2>
      <div class="grid grid-cols-2 gap-3">
        <select id="gender" class="border p-2 rounded">
          <option value="">Jenis Kelamin</option>
          <option value="pria">Pria</option>
          <option value="wanita">Wanita</option>
        </select>
        <input id="age" type="number" placeholder="Usia (tahun)" class="border p-2 rounded">
        <input id="weight" type="number" placeholder="Berat (kg)" class="border p-2 rounded">
        <input id="height" type="number" placeholder="Tinggi (cm)" class="border p-2 rounded">
      </div>

      <div class="mt-3">
        <select id="activity" class="border rounded w-full p-2 mb-2">
          <option value="">Pilih Aktivitas</option>
          <option value="1.2">Sangat ringan</option>
          <option value="1.375">Ringan (1-3x/minggu)</option>
          <option value="1.55">Sedang (3-5x/minggu)</option>
          <option value="1.725">Berat (6-7x/minggu)</option>
          <option value="1.9">Sangat berat</option>
        </select>
        <select id="goal" class="border rounded w-full p-2">
          <option value="">Pilih Tujuan</option>
          <option value="defisit">Defisit (turun berat)</option>
          <option value="maintenance">Stabil (maintenance)</option>
          <option value="surplus">Surplus (naik berat)</option>
        </select>
      </div>

      <button onclick="calculateNeeds()" 
              class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded w-full font-semibold">
        Hitung Kebutuhan Kalori
      </button>

      <p id="dailyNeed" class="text-center mt-3 font-semibold text-blue-700"></p>
    </section>

    <!-- Input makanan -->
    <section>
      <h2 class="text-lg font-semibold mb-2">ü•ó Input Makanan</h2>
      <div class="flex gap-2 mb-3">
        <input id="foodName" type="text" placeholder="Nama makanan (misal: nasi)" 
               class="flex-1 border rounded p-2">
        <input id="foodGram" type="number" placeholder="Gram" 
               class="w-24 border rounded p-2">
        <button onclick="addFood()" 
                class="bg-green-600 hover:bg-green-700 text-white px-4 rounded font-semibold">
          +
        </button>
      </div>

      <ul id="foodList" class="space-y-1 text-sm list-disc list-inside"></ul>

      <div class="text-center mt-4">
        <p class="text-lg font-semibold">Total Kalori: 
          <span id="totalCalories" class="text-blue-700">0</span> kcal
        </p>
        <p id="status" class="mt-2 text-sm font-semibold"></p>
        <button onclick="resetAll()" 
                class="mt-3 bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-sm">
          Reset Semua
        </button>
      </div>
    </section>

    <!-- Grafik progres -->
    <section class="mt-6">
      <h2 class="text-lg font-semibold mb-2">üìä Grafik Progres Kalori</h2>
      <canvas id="calorieChart" height="100"></canvas>
    </section>
  </div>

  <script>
    const calorieDB = {
      "nasi": 130, "ayam": 239, "telur": 155, "roti": 265, "mie": 138,
      "apel": 52, "pisang": 89, "ikan": 206, "tahu": 76, "tempe": 193,
      "daging sapi": 250, "susu": 60, "es teh": 50
    };
    

    let totalCalories = parseFloat(localStorage.getItem("totalCalories")) || 0;
    let dailyNeed = parseFloat(localStorage.getItem("dailyNeed")) || 0;
    let foodList = JSON.parse(localStorage.getItem("foodList")) || [];
    let calorieHistory = JSON.parse(localStorage.getItem("calorieHistory")) || [];

    const foodListEl = document.getElementById("foodList");
    const totalCalEl = document.getElementById("totalCalories");
    const statusEl = document.getElementById("status");
    const dailyNeedEl = document.getElementById("dailyNeed");

    let chart;

    // üîπ Inisialisasi tampilan awal
    window.onload = () => {
      renderFoodList();
      totalCalEl.textContent = totalCalories.toFixed(1);
      if (dailyNeed > 0) dailyNeedEl.textContent = `Kebutuhan kalori harian: ${dailyNeed} kcal`;
      updateStatus();
      initChart();
    };

    // üîπ Hitung kebutuhan kalori
    function calculateNeeds() {
      const g = val("gender"), a = num("age"), w = num("weight"), h = num("height"),
            act = num("activity"), goal = val("goal");

      if (!g || !a || !w || !h || !act || !goal)
        return msg("‚ö†Ô∏è Lengkapi semua data pengguna.", "red");

      let bmr = g === "pria"
        ? 88.362 + (13.397 * w) + (4.799 * h) - (5.677 * a)
        : 447.593 + (9.247 * w) + (3.098 * h) - (4.330 * a);

      let tdee = bmr * act;
      if (goal === "defisit") tdee -= 500;
      if (goal === "surplus") tdee += 500;

      dailyNeed = Math.round(tdee);
      localStorage.setItem("dailyNeed", dailyNeed);
      msg(`Kebutuhan kalori harian Anda: ${dailyNeed} kcal`, "blue");
      updateStatus();
    }

    // üîπ Tambahkan makanan
    function addFood() {
      const name = val("foodName").toLowerCase().trim();
      const gram = num("foodGram");
      if (!name || isNaN(gram) || gram <= 0) return alert("Masukkan nama dan jumlah gram valid!");
      if (!calorieDB[name]) return alert("Makanan tidak ada di database!");

      const cal = (calorieDB[name] / 100) * gram;
      totalCalories += cal;
      foodList.push({ name, gram, cal });

      saveData();
      renderFoodList();
      updateStatus();
      updateChart();
      clearInput();
    }

    // üîπ Render daftar makanan
    function renderFoodList() {
      foodListEl.innerHTML = "";
      foodList.forEach(f => {
        const li = document.createElement("li");
        li.textContent = `${capitalize(f.name)} - ${f.gram}g = ${f.cal.toFixed(1)} kcal`;
        foodListEl.appendChild(li);
      });
      totalCalEl.textContent = totalCalories.toFixed(1);
    }

    // üîπ Update status kalori
    function updateStatus() {
      if (!dailyNeed) return;
      let diff = totalCalories - dailyNeed;
      if (diff < -100) statusEl.textContent = "üî• Kamu masih defisit kalori hari ini.";
      else if (diff > 100) statusEl.textContent = "‚ö†Ô∏è Kamu sudah surplus kalori hari ini.";
      else statusEl.textContent = "‚úÖ Kalori kamu seimbang (maintenance).";
      statusEl.className = "mt-2 text-sm font-semibold " + 
        (diff < -100 ? "text-green-600" : diff > 100 ? "text-red-600" : "text-blue-600");
    }

    // üîπ Simpan ke localStorage
    function saveData() {
      localStorage.setItem("foodList", JSON.stringify(foodList));
      localStorage.setItem("totalCalories", totalCalories);
    }

    // üîπ Reset semua
    function resetAll() {
      if (!confirm("Yakin reset semua data?")) return;
      totalCalories = 0;
      dailyNeed = 0;
      foodList = [];
      localStorage.clear();
      renderFoodList();
      updateStatus();
      dailyNeedEl.textContent = "";
      updateChart(true);
    }

    // üîπ Grafik Chart.js
    function initChart() {
      const ctx = document.getElementById("calorieChart").getContext("2d");
      const today = new Date().toLocaleDateString();
      const lastEntry = calorieHistory[calorieHistory.length - 1];
      if (!lastEntry || lastEntry.date !== today)
        calorieHistory.push({ date: today, calories: totalCalories });

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: calorieHistory.map(d => d.date),
          datasets: [{
            label: 'Total Kalori',
            data: calorieHistory.map(d => d.calories),
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37,99,235,0.2)',
            tension: 0.3,
            fill: true,
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    function updateChart(reset = false) {
      const today = new Date().toLocaleDateString();
      if (reset) calorieHistory = [];
      else {
        const idx = calorieHistory.findIndex(d => d.date === today);
        if (idx >= 0) calorieHistory[idx].calories = totalCalories;
        else calorieHistory.push({ date: today, calories: totalCalories });
      }
      localStorage.setItem("calorieHistory", JSON.stringify(calorieHistory));
      if (chart) {
        chart.data.labels = calorieHistory.map(d => d.date);
        chart.data.datasets[0].data = calorieHistory.map(d => d.calories);
        chart.update();
      }
    }

    // üîπ Helper Functions
    const val = id => document.getElementById(id).value;
    const num = id => parseFloat(document.getElementById(id).value);
    const msg = (t, c) => { dailyNeedEl.textContent = t; dailyNeedEl.className = `text-center mt-3 font-semibold text-${c}-700`; };
    const capitalize = t => t.charAt(0).toUpperCase() + t.slice(1);
    const clearInput = () => { document.getElementById("foodName").value = ""; document.getElementById("foodGram").value = ""; };
  </script>
</body>
</html>
