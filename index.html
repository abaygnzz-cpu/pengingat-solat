<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Penghitung Kalori Harian</title>
<style>
  body{font-family:Poppins,sans-serif;background:#f4f6f8;margin:0;padding:0;color:#222}
  header{background:#2563eb;color:#fff;text-align:center;padding:1rem;font-size:1.5rem;font-weight:700}
  .container{max-width:900px;margin:1.5rem auto;background:#fff;border-radius:1rem;padding:1.2rem;box-shadow:0 4px 12px rgba(0,0,0,.1)}
  input,select,button{width:100%;padding:.6rem;border:1px solid #ccc;border-radius:.5rem;font-size:1rem}
  button{background:#2563eb;color:#fff;border:none;cursor:pointer;transition:.2s}
  button:hover{background:#1e40af}
  .row{display:flex;gap:.5rem;flex-wrap:wrap}.row>*{flex:1}
  .summary{background:#f9fafb;padding:1rem;border-radius:.5rem;margin-top:1rem;font-size:.95rem}
  table{width:100%;border-collapse:collapse;margin-top:1rem}
  th,td{padding:.5rem;border-bottom:1px solid #eee}
  .delete{color:#ef4444;cursor:pointer}
  .clear-btn{background:#ef4444;color:#fff;width:100%;margin-top:.8rem;padding:.7rem;border-radius:.5rem}
  .clear-btn:hover{background:#b91c1c}
  #chart{margin-top:1rem}
</style>
</head>
<body>
<header>üçΩÔ∏è Penghitung Kalori Harian</header>
<div class="container">
  <h3>üßç Data Pengguna</h3>
  <div class="row">
    <input type="number" id="age" placeholder="Umur (tahun)">
    <input type="number" id="height" placeholder="Tinggi (cm)">
    <input type="number" id="weight" placeholder="Berat (kg)">
  </div>
  <div class="row">
    <select id="gender"><option value="male">Laki-laki</option><option value="female">Perempuan</option></select>
    <select id="activity">
      <option value="1.2">Sangat ringan</option>
      <option value="1.375">Ringan</option>
      <option value="1.55">Sedang</option>
      <option value="1.725">Berat</option>
      <option value="1.9">Sangat berat</option>
    </select>
  </div>
  <button id="calcNeed">Hitung Kebutuhan</button>

  <h3>üç± Input Makanan</h3>
  <div class="row">
    <input type="text" id="searchFood" list="foodList" placeholder="Cari makanan (contoh: ayam bakar, pasta)">
    <datalist id="foodList"></datalist>
  </div>
  <div class="row">
    <input type="number" id="foodWeight" placeholder="Berat (gram)">
    <button id="addFood">Tambah</button>
  </div>
  <div class="row">
    <select id="goal">
      <option value="maintain">Pertahankan berat</option>
      <option value="deficit">Defisit kalori</option>
      <option value="surplus">Surplus kalori</option>
    </select>
  </div>

  <div class="summary">
    <p><b>Kebutuhan Kalori:</b> <span id="calNeed">0</span> kcal</p>
    <p><b>Kebutuhan Protein:</b> <span id="proteinNeed">0</span> g</p>
    <p><b>Total Kalori:</b> <span id="totalCal">0</span> kcal</p>
    <p><b>Total Protein:</b> <span id="totalProtein">0</span> g</p>
    <p><b>Sisa Kalori:</b> <span id="remainingCal">0</span> kcal</p>
  </div>

  <table>
    <thead><tr><th>Makanan</th><th>Kalori</th><th>Protein</th><th>Aksi</th></tr></thead>
    <tbody id="foodTable"></tbody>
  </table>

  <button class="clear-btn" id="clearAll">üóëÔ∏è Hapus Semua Data</button>
  <canvas id="chart" height="180"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const foodData={
  "nasi putih":{cal:130,protein:2.5},"nasi goreng":{cal:250,protein:6},"nasi uduk":{cal:230,protein:4},
  "ayam bakar":{cal:200,protein:27},"ayam goreng":{cal:260,protein:25},"ayam rebus":{cal:165,protein:31},"ayam geprek":{cal:280,protein:26},
  "telur rebus":{cal:70,protein:6},"telur dadar":{cal:180,protein:9},
  "ikan goreng":{cal:220,protein:23},"ikan bakar":{cal:150,protein:25},"udang goreng":{cal:210,protein:22},
  "tahu goreng":{cal:150,protein:8},"tempe goreng":{cal:190,protein:10},"tumis kangkung":{cal:80,protein:3},
  "sate ayam":{cal:270,protein:25},"rendang":{cal:250,protein:21},"soto ayam":{cal:120,protein:12},
  "bakso":{cal:150,protein:10},"mie goreng":{cal:300,protein:8},"mie ayam":{cal:350,protein:15},
  "pasta":{cal:130,protein:5},"spaghetti bolognese":{cal:350,protein:15},"lasagna":{cal:370,protein:18},
  "roti tawar":{cal:90,protein:3},"roti isi coklat":{cal:200,protein:4},"kentang goreng":{cal:312,protein:3},
  "sayur asem":{cal:70,protein:3},"sayur bayam":{cal:40,protein:2.5},"capcay":{cal:120,protein:6},
  "gado-gado":{cal:220,protein:9},"pecel":{cal:180,protein:7},"sambal goreng tempe":{cal:160,protein:8},
  "martabak telur":{cal:450,protein:20},"nugget ayam":{cal:270,protein:15},"burger":{cal:350,protein:20},
  "pizza":{cal:285,protein:12},"kebab":{cal:300,protein:16},"hotdog":{cal:320,protein:14},
  "jus alpukat":{cal:160,protein:2},"jus jeruk":{cal:85,protein:1},"es teh manis":{cal:90,protein:0},
  "kopi susu":{cal:110,protein:2},"teh tawar":{cal:2,protein:0},"air mineral":{cal:0,protein:0}
};

let foods=JSON.parse(localStorage.getItem("foods")||"[]"),
calNeed=+localStorage.getItem("calNeed")||0,
proteinNeed=+localStorage.getItem("proteinNeed")||0,
goal=localStorage.getItem("goal")||"maintain",chart;

function updateChart(total,remain){
  const ctx=document.getElementById("chart").getContext("2d");
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:"doughnut",
    data:{labels:["Terkonsumsi","Sisa"],
    datasets:[{data:[total,Math.max(remain,0)],backgroundColor:["#2563eb","#e5e7eb"],borderWidth:0}]},
    options:{plugins:{legend:{display:true}},animation:{duration:250}}});
}
function updateList(){
  const tbody=document.getElementById("foodTable");tbody.innerHTML="";
  let tCal=0,tPro=0;
  foods.forEach((f,i)=>{
    tCal+=f.cal;tPro+=f.protein;
    tbody.insertAdjacentHTML("beforeend",
      `<tr><td>${f.name}</td><td>${f.cal.toFixed(1)}</td><td>${f.protein.toFixed(1)}</td>
      <td><span class='delete' onclick='del(${i})'>üóëÔ∏è</span></td></tr>`);
  });
  document.getElementById("calNeed").textContent=Math.round(calNeed);
  document.getElementById("proteinNeed").textContent=Math.round(proteinNeed);
  document.getElementById("totalCal").textContent=tCal.toFixed(1);
  document.getElementById("totalProtein").textContent=tPro.toFixed(1);
  document.getElementById("remainingCal").textContent=(calNeed-tCal).toFixed(1);
  localStorage.setItem("foods",JSON.stringify(foods));
  localStorage.setItem("goal",goal);
  updateChart(tCal,calNeed-tCal);
}
function del(i){foods.splice(i,1);updateList();}
function calcNeed(){
  const a=+age.value,h=+height.value,w=+weight.value,g=gender.value,act=+activity.value;
  if(!a||!h||!w)return alert("Lengkapi data!");
  const bmr=(g=="male"?88.362+13.397*w+4.799*h-5.677*a:447.593+9.247*w+3.098*h-4.33*a)*act;
  const adj=goal=="deficit"?-300:goal=="surplus"?300:0;
  calNeed=bmr+adj;proteinNeed=goal=="surplus"?w*2:goal=="deficit"?w*1.6:w*1.4;
  localStorage.setItem("calNeed",calNeed);localStorage.setItem("proteinNeed",proteinNeed);updateList();
}
calcNeedBtn.onclick=calcNeed;
addFood.onclick=()=>{
  const n=searchFood.value.toLowerCase(),w=parseFloat(foodWeight.value);
  if(!foodData[n]||isNaN(w)||w<=0)return alert("Makanan/berat tidak valid!");
  foods.push({name:n,cal:foodData[n].cal*w/100,protein:foodData[n].protein*w/100});
  foodWeight.value="";updateList();
};
searchFood.oninput=e=>{
  const val=e.target.value.toLowerCase();
  foodList.innerHTML=Object.keys(foodData).filter(f=>f.includes(val)).slice(0,15).map(f=>`<option value="${f}">`).join("");
};
goalSel.onchange=e=>goal=e.target.value;
clearAll.onclick=()=>{
  if(confirm("Yakin hapus semua data?")){
    foods=[];localStorage.clear();calNeed=proteinNeed=0;updateList();alert("Data direset!");
  }
};
updateList();
</script>
</body>
</html>
