<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Penghitung Kalori Harian</title>
<style>
  body{font-family:Poppins,sans-serif;background:#f4f6f8;margin:0;padding:0;color:#222}
  header{background:#2563eb;color:#fff;text-align:center;padding:1rem;font-size:1.5rem;font-weight:700}
  .container{max-width:900px;margin:1.5rem auto;background:#fff;border-radius:1rem;padding:1.2rem;box-shadow:0 4px 12px rgba(0,0,0,.1)}
  input,select,button{width:100%;padding:.6rem;border:1px solid #ccc;border-radius:.5rem;font-size:1rem}
  button{background:#2563eb;color:#fff;border:none;cursor:pointer;transition:.2s}
  button:hover{background:#1e40af}
  .row{display:flex;gap:.5rem;flex-wrap:wrap}.row>*{flex:1}
  .summary{background:#f9fafb;padding:1rem;border-radius:.5rem;margin-top:1rem;font-size:.95rem}
  table{width:100%;border-collapse:collapse;margin-top:1rem}
  th,td{padding:.5rem;border-bottom:1px solid #eee;text-align:center}
  .delete{color:#ef4444;cursor:pointer}
  .clear-btn{background:#ef4444;color:#fff;width:100%;margin-top:.8rem;padding:.7rem;border-radius:.5rem}
  .clear-btn:hover{background:#b91c1c}
  #chart{margin-top:1rem}
  #searchFood{margin-top:.5rem}
</style>
</head>
<body>
<header>🍽️ Penghitung Kalori Harian</header>
<div class="container">
  <h3>🧍 Data Pengguna</h3>
  <div class="row">
    <input type="number" id="age" placeholder="Umur (tahun)">
    <input type="number" id="height" placeholder="Tinggi (cm)">
    <input type="number" id="weight" placeholder="Berat (kg)">
  </div>
  <div class="row">
    <select id="gender">
      <option value="male">Laki-laki</option>
      <option value="female">Perempuan</option>
    </select>
    <select id="activity">
      <option value="1.2">Sangat ringan</option>
      <option value="1.375">Ringan</option>
      <option value="1.55">Sedang</option>
      <option value="1.725">Berat</option>
      <option value="1.9">Sangat berat</option>
    </select>
  </div>
  <button id="calcNeed">Hitung Kebutuhan</button>

  <h3>🍱 Input Makanan</h3>
  <div class="row">
    <select id="categorySelect">
      <option value="pokok">🍚 Makanan Pokok</option>
      <option value="lauk">🍗 Lauk</option>
      <option value="sayur">🥦 Sayur</option>
      <option value="minuman">🥤 Minuman</option>
      <option value="snack">🍩 Snack</option>
      <option value="lainnya">🍽️ Lainnya</option>
    </select>
    <input type="text" id="searchFood" placeholder="Cari makanan...">
    <select id="foodSelect"></select>
    <input type="number" id="foodWeight" placeholder="Berat (gram)">
    <button id="addFood">Tambah</button>
  </div>
  <div class="row">
    <select id="goal">
      <option value="maintain">Pertahankan berat</option>
      <option value="deficit">Defisit kalori</option>
      <option value="surplus">Surplus kalori</option>
    </select>
  </div>

  <div class="summary">
    <p><b>Kebutuhan Kalori:</b> <span id="calNeed">0</span> kcal</p>
    <p><b>Kebutuhan Protein:</b> <span id="proteinNeed">0</span> g</p>
    <p><b>Total Kalori:</b> <span id="totalCal">0</span> kcal</p>
    <p><b>Total Protein:</b> <span id="totalProtein">0</span> g</p>
    <p><b>Sisa Kalori:</b> <span id="remainingCal">0</span> kcal</p>
  </div>

  <table>
    <thead><tr><th>Makanan</th><th>Kalori</th><th>Protein</th><th>Aksi</th></tr></thead>
    <tbody id="foodTable"></tbody>
  </table>

  <button class="clear-btn" id="clearAll">🗑️ Hapus Semua Data</button>
  <canvas id="chart" height="180"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ============ DATA MAKANAN ==============
const foodData={
  pokok:{
    "Nasi Putih":{cal:130,protein:2.5},"Nasi Goreng":{cal:250,protein:6},"Nasi Uduk":{cal:230,protein:4},
    "Pasta":{cal:130,protein:5},"Spaghetti Bolognese":{cal:350,protein:15},
    "Mie Goreng":{cal:300,protein:8},"Mie Ayam":{cal:350,protein:15},"Roti Tawar":{cal:90,protein:3},
    "Kentang Rebus":{cal:80,protein:2}
  },
  lauk:{
    "Ayam Bakar":{cal:200,protein:27},"Ayam Goreng":{cal:260,protein:25},"Ayam Rebus":{cal:165,protein:31},
    "Ayam Geprek":{cal:280,protein:26},"Telur Rebus":{cal:70,protein:6},"Telur Dadar":{cal:180,protein:9},
    "Ikan Goreng":{cal:220,protein:23},"Ikan Bakar":{cal:150,protein:25},"Udang Goreng":{cal:210,protein:22},
    "Tahu Goreng":{cal:150,protein:8},"Tempe Goreng":{cal:190,protein:10},"Rendang":{cal:250,protein:21},
    "Sate Ayam":{cal:270,protein:25},"Bakso":{cal:150,protein:10}
  },
  sayur:{
    "Tumis Kangkung":{cal:80,protein:3},"Sayur Asem":{cal:70,protein:3},"Sayur Bayam":{cal:40,protein:2.5},
    "Capcay":{cal:120,protein:6},"Gado-Gado":{cal:220,protein:9},"Pecel":{cal:180,protein:7}
  },
  minuman:{
    "Jus Alpukat":{cal:160,protein:2},"Jus Jeruk":{cal:85,protein:1},"Es Teh Manis":{cal:90,protein:0},
    "Kopi Susu":{cal:110,protein:2},"Teh Tawar":{cal:2,protein:0},"Air Mineral":{cal:0,protein:0}
  },
  snack:{
    "Martabak Telur":{cal:450,protein:20},"Nugget Ayam":{cal:270,protein:15},
    "Burger":{cal:350,protein:20},"Pizza":{cal:285,protein:12},"Kebab":{cal:300,protein:16},"Hotdog":{cal:320,protein:14},
    "Roti Isi Coklat":{cal:200,protein:4},"Kentang Goreng":{cal:312,protein:3}
  },
  lainnya:{
    "Soto Ayam":{cal:120,protein:12},"Sambal Goreng Tempe":{cal:160,protein:8},"Lasagna":{cal:370,protein:18}
  }
};

const foodSelect=document.getElementById("foodSelect");
const searchFood=document.getElementById("searchFood");
const categorySelect=document.getElementById("categorySelect");
let foods=JSON.parse(localStorage.getItem("foods")||"[]"),
calNeed=+localStorage.getItem("calNeed")||0,
proteinNeed=+localStorage.getItem("proteinNeed")||0,
goal=localStorage.getItem("goal")||"maintain",
chart;

// ============ DROPDOWN & PENCARIAN ============
function renderFoodOptions(keyword=""){
  const cat=categorySelect.value;
  foodSelect.innerHTML="";
  Object.keys(foodData[cat])
    .filter(f=>f.toLowerCase().includes(keyword.toLowerCase()))
    .forEach(f=>{
      const opt=document.createElement("option");
      opt.value=f;opt.textContent=f;
      foodSelect.appendChild(opt);
    });
}
categorySelect.onchange=()=>renderFoodOptions(searchFood.value);
searchFood.oninput=()=>renderFoodOptions(searchFood.value);
renderFoodOptions();

// ============ UPDATE GRAFIK ============
function updateChart(total,remain){
  const ctx=document.getElementById("chart").getContext("2d");
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:"doughnut",
    data:{labels:["Terkonsumsi","Sisa"],
    datasets:[{data:[total,Math.max(remain,0)],backgroundColor:["#2563eb","#e5e7eb"],borderWidth:0}]},
    options:{plugins:{legend:{display:true}},animation:{duration:200}}});
}

// ============ UPDATE TABEL ============
function updateList(){
  const tbody=document.getElementById("foodTable");
  tbody.innerHTML="";
  let tCal=0,tPro=0;
  foods.forEach((f,i)=>{
    tCal+=f.cal;tPro+=f.protein;
    tbody.insertAdjacentHTML("beforeend",
      `<tr><td>${f.name}</td><td>${f.cal.toFixed(1)}</td><td>${f.protein.toFixed(1)}</td>
      <td><span class='delete' onclick='del(${i})'>🗑️</span></td></tr>`);
  });
  document.getElementById("calNeed").textContent=Math.round(calNeed);
  document.getElementById("proteinNeed").textContent=Math.round(proteinNeed);
  document.getElementById("totalCal").textContent=tCal.toFixed(1);
  document.getElementById("totalProtein").textContent=tPro.toFixed(1);
  document.getElementById("remainingCal").textContent=(calNeed-tCal).toFixed(1);
  localStorage.setItem("foods",JSON.stringify(foods));
  localStorage.setItem("goal",goal);
  updateChart(tCal,calNeed-tCal);
}
function del(i){foods.splice(i,1);updateList();}

// ============ HITUNG KEBUTUHAN ============
function calcNeed(){
  const a=+document.getElementById("age").value,
        h=+document.getElementById("height").value,
        w=+document.getElementById("weight").value,
        g=document.getElementById("gender").value,
        act=+document.getElementById("activity").value,
        goalSel=document.getElementById("goal").value;
  if(!a||!h||!w)return alert("Lengkapi data!");
  const bmr=(g=="male"?88.362+13.397*w+4.799*h-5.677*a:447.593+9.247*w+3.098*h-4.33*a)*act;
  const adj=goalSel=="deficit"?-300:goalSel=="surplus"?300:0;
  calNeed=bmr+adj;
  proteinNeed=goalSel=="surplus"?w*2:goalSel=="deficit"?w*1.6:w*1.4;
  localStorage.setItem("calNeed",calNeed);
  localStorage.setItem("proteinNeed",proteinNeed);
  goal=goalSel;
  updateList();
}
document.getElementById("calcNeed").onclick=calcNeed;

// ============ TAMBAH & HAPUS ============
document.getElementById("addFood").onclick=()=>{
  const cat=categorySelect.value,n=foodSelect.value,w=parseFloat(document.getElementById("foodWeight").value);
  if(!foodData[cat][n]||isNaN(w)||w<=0)return alert("Pilih makanan dan isi berat dengan benar!");
  foods.push({name:n,cal:foodData[cat][n].cal*w/100,protein:foodData[cat][n].protein*w/100});
  document.getElementById("foodWeight").value="";
  updateList();
};
document.getElementById("goal").onchange=e=>goal=e.target.value;
document.getElementById("clearAll").onclick=()=>{
  if(confirm("Yakin hapus semua data?")){
    foods=[];localStorage.clear();calNeed=proteinNeed=0;updateList();
  }
};
updateList();
</script>
</body>
</html>
